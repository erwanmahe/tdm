<!doctype html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Mon tour du monde pas à pas</title>
    <link rel="stylesheet" href="assets/styles.css" />

    <!-- Theme fonts and styles -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Material+Icons&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="assets/theme.css" />
    <link rel="stylesheet" href="assets/lightbox.css" />
  </head>
  <body>
    <div class="wrapper">
      <aside class="sidebar">
        <a class="brand" href="index.html">La carte</a>
        <nav class="nav">
          <div
            class="section"
            style="
              margin: 10px 0 6px;
              color: #614e33;
              font-size: 12px;
              font-weight: bold;
              text-transform: uppercase;
              letter-spacing: 0.08em;
            "
          >
            europe
          </div>
          <a class="link" href="europe/madrid/index.html">Madrid</a>
          <div
            class="section"
            style="
              margin: 10px 0 6px;
              color: #614e33;
              font-size: 12px;
              font-weight: bold;
              text-transform: uppercase;
              letter-spacing: 0.08em;
            "
          >
            amerique du sud
          </div>
          <a class="link" href="amsud/lima/index.html">Lima</a>
          <a class="link" href="amsud/pisco/index.html">Pisco</a>
          <a class="link" href="amsud/arequipa/index.html">Arequipa</a>
          <a class="link" href="amsud/cuzco/index.html">Cuzco</a>
          <a class="link" href="amsud/lapaz/index.html">La Paz</a>
          <a class="link" href="amsud/uyuni/index.html">Uyuni</a>
          <a class="link" href="amsud/salta/index.html">Salta</a>
          <a class="link" href="amsud/mendoza/index.html">Mendoza</a>
          <a class="link" href="amsud/saopaulo/index.html">São Paulo</a>
          <a class="link" href="amsud/parati/index.html">Parati</a>
          <a class="link" href="amsud/rio/index.html">Rio</a>
          <a class="link" href="amsud/salvador/index.html">Salvador</a>
          <a class="link" href="amsud/olinda/index.html">Olinda</a>
          <a class="link" href="amsud/natal/index.html">Natal</a>
          <a class="link" href="amsud/rio2/index.html">Rio</a>
          <a class="link" href="amsud/iguazu/index.html">Foz de Iguazu</a>
          <a class="link" href="amsud/buenosaires/index.html">Buenos Aires</a>
          <a class="link" href="amsud/santiago/index.html">Santiago</a>
          <a class="link" href="amsud/havana/index.html">La Havane</a>
          <a class="link" href="amsud/cienfuegos/index.html">Cienfuegos</a>
          <a class="link" href="amsud/havana2/index.html">La Havane</a>
          <div
            class="section"
            style="
              margin: 10px 0 6px;
              color: #614e33;
              font-size: 12px;
              font-weight: bold;
              text-transform: uppercase;
              letter-spacing: 0.08em;
            "
          >
            australie nouvelle-zelande
          </div>
          <a class="link" href="ausnz/auckland/index.html">Auckland</a>
          <a class="link" href="ausnz/tororua/index.html">Tororua</a>
          <a class="link" href="ausnz/taupo/index.html">Taupo</a>
          <a class="link" href="ausnz/wellington/index.html">Wellington</a>
          <a class="link" href="ausnz/picton/index.html">Picton</a>
          <a class="link" href="ausnz/melbourne/index.html">Melbourne</a>
          <a class="link" href="ausnz/darwin/index.html">Darwin</a>
          <a class="link" href="ausnz/cairns/index.html">Cairns</a>
          <a class="link" href="ausnz/sydney/index.html">Sydney</a>
          <div
            class="section"
            style="
              margin: 10px 0 6px;
              color: #614e33;
              font-size: 12px;
              font-weight: bold;
              text-transform: uppercase;
              letter-spacing: 0.08em;
            "
          >
            asie
          </div>
          <a class="link" href="asie/bangkok/index.html">Bangkok</a>
          <a class="link" href="asie/kohsamui/index.html">Koh Samui</a>
          <a class="link" href="asie/bangkok2/index.html">Bangkok</a>
          <a class="link" href="asie/kohchang/index.html">Koh Chang</a>
          <a class="link" href="asie/chiangmai/index.html">Chiang Mai</a>
          <a class="link" href="asie/chiangrai/index.html">Chiang Rai</a>
          <a class="link" href="asie/luangprabang/index.html">Luang Prabang</a>
          <a class="link" href="asie/vientiane/index.html">Vientiane</a>
          <a class="link" href="asie/pakse/index.html">Pakse</a>
          <a class="link" href="asie/donkhong/index.html">Don Khong</a>
          <a class="link" href="asie/stungtreng/index.html">Stung Treng</a>
          <a class="link" href="asie/phnompenh/index.html">Phnom Penh</a>
          <a class="link" href="asie/angkor/index.html">Angkor</a>
          <a class="link" href="asie/colombo/index.html">Colombo</a>
          <a class="link" href="asie/kandy/index.html">Kandy</a>
          <a class="link" href="asie/nuwaraeliya/index.html">Nuwara Eliya</a>
          <a class="link" href="asie/kandy2/index.html">Kandy</a>
          <a class="link" href="asie/sigiriya/index.html">Sigiriya</a>
          <a class="link" href="asie/trincomalee/index.html">Trincomalée</a>
          <a class="link" href="asie/kandy3/index.html">Kandy</a>
          <a class="link" href="asie/chennai/index.html">Chennai</a>
          <a class="link" href="asie/bangalore/index.html">Bangalore</a>
          <a class="link" href="asie/goa/index.html">Goa</a>
          <a class="link" href="asie/mumbay/index.html">Mumbay</a>
          <a class="link" href="asie/varanasi/index.html">Varanasi</a>
          <a class="link" href="asie/katmandou/index.html">Katmandou</a>
          <a class="link" href="asie/bali/index.html">Bali</a>
          <a class="link" href="asie/hongkong/index.html">Hong Kong</a>
          <div
            class="section"
            style="
              margin: 10px 0 6px;
              color: #614e33;
              font-size: 12px;
              font-weight: bold;
              text-transform: uppercase;
              letter-spacing: 0.08em;
            "
          >
            afrique
          </div>
          <a class="link" href="afrique/nairobi/index.html">Nairobi</a>
          <a class="link" href="afrique/mombasa/index.html">Mombasa</a>
          <a class="link" href="afrique/tiwi/index.html">Tiwi Beach</a>
          <a class="link" href="afrique/zanzibar/index.html">Zanzibar</a>
          <a class="link" href="afrique/capetown/index.html">Cape Town</a>
        </nav>
      </aside>

      <main class="content">
        <div class="header">
          <div class="h1">Mon tour du monde pas à pas</div>
          <div class="h2">Carte interactive</div>
        </div>

        <svg
          id="worldmap"
          width="100%"
          height="600"
          viewBox="0 0 1100 600"
        ></svg>
        <script src="assets/d3-array.min.js"></script>
        <script src="assets/d3-geo.min.js"></script>
        <script src="assets/topojson-client.min.js"></script>
        <script src="assets/world-110m.js"></script>
        <script>
          (function () {
            const svg = document.getElementById("worldmap");
            const width = svg.viewBox.baseVal.width;
            const height = svg.viewBox.baseVal.height;
            const NS = "http://www.w3.org/2000/svg";
            function el(name, attrs) {
              const e = document.createElementNS(NS, name);
              if (attrs) {
                for (const k in attrs) {
                  e.setAttribute(k, attrs[k]);
                }
              }
              return e;
            }
            const projection = d3.geoNaturalEarth1().fitExtent(
              [
                [10, 10],
                [width - 10, height - 10],
              ],
              { type: "Sphere" },
            );
            const path = d3.geoPath(projection);
            const root = el("g", { id: "groot" });
            svg.appendChild(root);
            let scale = 1,
              tx = 0,
              ty = 0;
            function applyTransform() {
              root.setAttribute(
                "transform",
                "translate(" +
                  tx.toFixed(1) +
                  " " +
                  ty.toFixed(1) +
                  ") scale(" +
                  scale.toFixed(3) +
                  ")",
              );
              const inv = 1 / scale;
              if (window.__markers) {
                window.__markers.forEach((M) => {
                  M.el.setAttribute(
                    "transform",
                    "translate(" +
                      M.x.toFixed(1) +
                      " " +
                      M.y.toFixed(1) +
                      ") scale(" +
                      inv.toFixed(3) +
                      ")",
                  );
                });
              }
              // Show arrowheads if the scaled segment length exceeds threshold; normalize head size and rotation
              const TH = 150; // pixels
              if (window.__arrowheads) {
                window.__arrowheads.forEach((A) => {
                  const node = A.el || A;
                  const bl =
                    A.bl != null
                      ? A.bl
                      : parseFloat(node.getAttribute("data-bl") || "0");
                  const show = bl * scale >= TH;
                  node.style.display = show ? "" : "none";
                  if (A.el) {
                    const invs = (1 / scale).toFixed(3);
                    node.setAttribute(
                      "transform",
                      "translate(" +
                        A.x.toFixed(1) +
                        " " +
                        A.y.toFixed(1) +
                        ") rotate(" +
                        A.rot.toFixed(2) +
                        ") scale(" +
                        invs +
                        ")",
                    );
                  }
                });
              }
            }
            svg.addEventListener(
              "wheel",
              (ev) => {
                ev.preventDefault();
                const rect = svg.getBoundingClientRect();
                const mx = ev.clientX - rect.left,
                  my = ev.clientY - rect.top;
                const k = Math.exp(-ev.deltaY * 0.001);
                const newScale = Math.min(32, Math.max(0.25, scale * k));
                const factor = newScale / scale;
                tx = mx - factor * (mx - tx);
                ty = my - factor * (my - ty);
                scale = newScale;
                applyTransform();
              },
              { passive: false },
            );
            let dragging = false,
              lastX = 0,
              lastY = 0;
            svg.addEventListener("mousedown", (ev) => {
              dragging = true;
              lastX = ev.clientX;
              lastY = ev.clientY;
            });
            svg.addEventListener("mousemove", (ev) => {
              if (!dragging) return;
              const dx = ev.clientX - lastX,
                dy = ev.clientY - lastY;
              tx += dx;
              ty += dy;
              lastX = ev.clientX;
              lastY = ev.clientY;
              applyTransform();
            });
            svg.addEventListener("mouseup", () => {
              dragging = false;
            });
            svg.addEventListener("mouseleave", () => {
              dragging = false;
            });
            try {
              const world = window.WORLD;
              const land = topojson.feature(world, world.objects.land);
              const landPath = el("path", {
                d: path(land),
                fill: "#334155",
                stroke: "#1f2937",
                "stroke-width": 1,
              });
              root.appendChild(landPath);
              const defs = el("defs");
              const marker = el("marker", {
                id: "arrow",
                markerWidth: 6,
                markerHeight: 6,
                refX: 6,
                refY: 3,
                orient: "auto",
                markerUnits: "strokeWidth",
              });
              const arrowPath = el("path", {
                d: "M 0 0 L 6 3 L 0 6 z",
                fill: "#22d3ee",
              });
              marker.appendChild(arrowPath);
              defs.appendChild(marker);
              svg.appendChild(defs);
              const cities = [
                {
                  region: "europe",
                  city: "madrid",
                  label: "Madrid",
                  lon: -3.7038,
                  lat: 40.4168,
                  url: "europe/madrid/index.html",
                },
                {
                  region: "amsud",
                  city: "lima",
                  label: "Lima",
                  lon: -77.0428,
                  lat: -12.0464,
                  url: "amsud/lima/index.html",
                },
                {
                  region: "amsud",
                  city: "pisco",
                  label: "Pisco",
                  lon: -76.2167,
                  lat: -13.7,
                  url: "amsud/pisco/index.html",
                },
                {
                  region: "amsud",
                  city: "arequipa",
                  label: "Arequipa",
                  lon: -71.535,
                  lat: -16.409,
                  url: "amsud/arequipa/index.html",
                },
                {
                  region: "amsud",
                  city: "cuzco",
                  label: "Cuzco",
                  lon: -71.9675,
                  lat: -13.532,
                  url: "amsud/cuzco/index.html",
                },
                {
                  region: "amsud",
                  city: "lapaz",
                  label: "La Paz",
                  lon: -68.1193,
                  lat: -16.4897,
                  url: "amsud/lapaz/index.html",
                },
                {
                  region: "amsud",
                  city: "uyuni",
                  label: "Uyuni",
                  lon: -66.825,
                  lat: -20.46,
                  url: "amsud/uyuni/index.html",
                },
                {
                  region: "amsud",
                  city: "salta",
                  label: "Salta",
                  lon: -65.4232,
                  lat: -24.7821,
                  url: "amsud/salta/index.html",
                },
                {
                  region: "amsud",
                  city: "mendoza",
                  label: "Mendoza",
                  lon: -68.8458,
                  lat: -32.8895,
                  url: "amsud/mendoza/index.html",
                },
                {
                  region: "amsud",
                  city: "saopaulo",
                  label: "S\u00e3o Paulo",
                  lon: -46.6339,
                  lat: -23.5505,
                  url: "amsud/saopaulo/index.html",
                },
                {
                  region: "amsud",
                  city: "parati",
                  label: "Parati",
                  lon: -44.7178,
                  lat: -23.2221,
                  url: "amsud/parati/index.html",
                },
                {
                  region: "amsud",
                  city: "rio",
                  label: "Rio",
                  lon: -43.1729,
                  lat: -22.9068,
                  url: "amsud/rio/index.html",
                },
                {
                  region: "amsud",
                  city: "salvador",
                  label: "Salvador",
                  lon: -38.5014,
                  lat: -12.973,
                  url: "amsud/salvador/index.html",
                },
                {
                  region: "amsud",
                  city: "olinda",
                  label: "Olinda",
                  lon: -34.8553,
                  lat: -8.0089,
                  url: "amsud/olinda/index.html",
                },
                {
                  region: "amsud",
                  city: "natal",
                  label: "Natal",
                  lon: -35.2094,
                  lat: -5.7945,
                  url: "amsud/natal/index.html",
                },
                {
                  region: "amsud",
                  city: "rio2",
                  label: "Rio",
                  lon: -43.1729,
                  lat: -22.9068,
                  url: "amsud/rio2/index.html",
                },
                {
                  region: "amsud",
                  city: "iguazu",
                  label: "Foz de Iguazu",
                  lon: -54.585,
                  lat: -25.6953,
                  url: "amsud/iguazu/index.html",
                },
                {
                  region: "amsud",
                  city: "buenosaires",
                  label: "Buenos Aires",
                  lon: -58.3816,
                  lat: -34.6037,
                  url: "amsud/buenosaires/index.html",
                },
                {
                  region: "amsud",
                  city: "santiago",
                  label: "Santiago",
                  lon: -70.6693,
                  lat: -33.4489,
                  url: "amsud/santiago/index.html",
                },
                {
                  region: "amsud",
                  city: "havana",
                  label: "La Havane",
                  lon: -82.3666,
                  lat: 23.1136,
                  url: "amsud/havana/index.html",
                },
                {
                  region: "amsud",
                  city: "cienfuegos",
                  label: "Cienfuegos",
                  lon: -80.457,
                  lat: 22.1496,
                  url: "amsud/cienfuegos/index.html",
                },
                {
                  region: "amsud",
                  city: "havana2",
                  label: "La Havane",
                  lon: -82.3666,
                  lat: 23.1136,
                  url: "amsud/havana2/index.html",
                },
                {
                  region: "ausnz",
                  city: "auckland",
                  label: "Auckland",
                  lon: 174.7633,
                  lat: -36.8485,
                  url: "ausnz/auckland/index.html",
                },
                {
                  region: "ausnz",
                  city: "tororua",
                  label: "Tororua",
                  lon: 176.2483,
                  lat: -38.1368,
                  url: "ausnz/tororua/index.html",
                },
                {
                  region: "ausnz",
                  city: "taupo",
                  label: "Taupo",
                  lon: 176.0833,
                  lat: -38.6833,
                  url: "ausnz/taupo/index.html",
                },
                {
                  region: "ausnz",
                  city: "wellington",
                  label: "Wellington",
                  lon: 174.7762,
                  lat: -41.2866,
                  url: "ausnz/wellington/index.html",
                },
                {
                  region: "ausnz",
                  city: "picton",
                  label: "Picton",
                  lon: 173.95,
                  lat: -41.2928,
                  url: "ausnz/picton/index.html",
                },
                {
                  region: "ausnz",
                  city: "melbourne",
                  label: "Melbourne",
                  lon: 144.9631,
                  lat: -37.8136,
                  url: "ausnz/melbourne/index.html",
                },
                {
                  region: "ausnz",
                  city: "darwin",
                  label: "Darwin",
                  lon: 130.8456,
                  lat: -12.4634,
                  url: "ausnz/darwin/index.html",
                },
                {
                  region: "ausnz",
                  city: "cairns",
                  label: "Cairns",
                  lon: 145.7703,
                  lat: -16.9186,
                  url: "ausnz/cairns/index.html",
                },
                {
                  region: "ausnz",
                  city: "sydney",
                  label: "Sydney",
                  lon: 151.2093,
                  lat: -33.8688,
                  url: "ausnz/sydney/index.html",
                },
                {
                  region: "asie",
                  city: "bangkok",
                  label: "Bangkok",
                  lon: 100.5018,
                  lat: 13.7563,
                  url: "asie/bangkok/index.html",
                },
                {
                  region: "asie",
                  city: "kohsamui",
                  label: "Koh Samui",
                  lon: 99.9357,
                  lat: 9.512,
                  url: "asie/kohsamui/index.html",
                },
                {
                  region: "asie",
                  city: "bangkok2",
                  label: "Bangkok",
                  lon: 100.5018,
                  lat: 13.7563,
                  url: "asie/bangkok2/index.html",
                },
                {
                  region: "asie",
                  city: "kohchang",
                  label: "Koh Chang",
                  lon: 102.367,
                  lat: 12.07,
                  url: "asie/kohchang/index.html",
                },
                {
                  region: "asie",
                  city: "chiangmai",
                  label: "Chiang Mai",
                  lon: 98.993,
                  lat: 18.788,
                  url: "asie/chiangmai/index.html",
                },
                {
                  region: "asie",
                  city: "chiangrai",
                  label: "Chiang Rai",
                  lon: 99.8325,
                  lat: 19.9105,
                  url: "asie/chiangrai/index.html",
                },
                {
                  region: "asie",
                  city: "luangprabang",
                  label: "Luang Prabang",
                  lon: 102.136,
                  lat: 19.885,
                  url: "asie/luangprabang/index.html",
                },
                {
                  region: "asie",
                  city: "vientiane",
                  label: "Vientiane",
                  lon: 102.634,
                  lat: 17.975,
                  url: "asie/vientiane/index.html",
                },
                {
                  region: "asie",
                  city: "pakse",
                  label: "Pakse",
                  lon: 105.783,
                  lat: 15.117,
                  url: "asie/pakse/index.html",
                },
                {
                  region: "asie",
                  city: "donkhong",
                  label: "Don Khong",
                  lon: 105.85,
                  lat: 14.0,
                  url: "asie/donkhong/index.html",
                },
                {
                  region: "asie",
                  city: "stungtreng",
                  label: "Stung Treng",
                  lon: 106.008,
                  lat: 13.525,
                  url: "asie/stungtreng/index.html",
                },
                {
                  region: "asie",
                  city: "phnompenh",
                  label: "Phnom Penh",
                  lon: 104.921,
                  lat: 11.565,
                  url: "asie/phnompenh/index.html",
                },
                {
                  region: "asie",
                  city: "angkor",
                  label: "Angkor",
                  lon: 103.8667,
                  lat: 13.4125,
                  url: "asie/angkor/index.html",
                },
                {
                  region: "asie",
                  city: "colombo",
                  label: "Colombo",
                  lon: 79.8612,
                  lat: 6.9271,
                  url: "asie/colombo/index.html",
                },
                {
                  region: "asie",
                  city: "kandy",
                  label: "Kandy",
                  lon: 80.6337,
                  lat: 7.2906,
                  url: "asie/kandy/index.html",
                },
                {
                  region: "asie",
                  city: "nuwaraeliya",
                  label: "Nuwara Eliya",
                  lon: 80.7829,
                  lat: 6.9497,
                  url: "asie/nuwaraeliya/index.html",
                },
                {
                  region: "asie",
                  city: "kandy2",
                  label: "Kandy",
                  lon: 80.6337,
                  lat: 7.2906,
                  url: "asie/kandy2/index.html",
                },
                {
                  region: "asie",
                  city: "sigiriya",
                  label: "Sigiriya",
                  lon: 80.7603,
                  lat: 7.957,
                  url: "asie/sigiriya/index.html",
                },
                {
                  region: "asie",
                  city: "trincomalee",
                  label: "Trincomal\u00e9e",
                  lon: 81.233,
                  lat: 8.571,
                  url: "asie/trincomalee/index.html",
                },
                {
                  region: "asie",
                  city: "kandy3",
                  label: "Kandy",
                  lon: 80.6337,
                  lat: 7.2906,
                  url: "asie/kandy3/index.html",
                },
                {
                  region: "asie",
                  city: "chennai",
                  label: "Chennai",
                  lon: 80.2707,
                  lat: 13.0827,
                  url: "asie/chennai/index.html",
                },
                {
                  region: "asie",
                  city: "bangalore",
                  label: "Bangalore",
                  lon: 77.5946,
                  lat: 12.9716,
                  url: "asie/bangalore/index.html",
                },
                {
                  region: "asie",
                  city: "goa",
                  label: "Goa",
                  lon: 74.124,
                  lat: 15.2993,
                  url: "asie/goa/index.html",
                },
                {
                  region: "asie",
                  city: "mumbay",
                  label: "Mumbay",
                  lon: 72.8777,
                  lat: 19.076,
                  url: "asie/mumbay/index.html",
                },
                {
                  region: "asie",
                  city: "varanasi",
                  label: "Varanasi",
                  lon: 82.9739,
                  lat: 25.3176,
                  url: "asie/varanasi/index.html",
                },
                {
                  region: "asie",
                  city: "katmandou",
                  label: "Katmandou",
                  lon: 85.324,
                  lat: 27.7172,
                  url: "asie/katmandou/index.html",
                },
                {
                  region: "asie",
                  city: "bali",
                  label: "Bali",
                  lon: 115.1889,
                  lat: -8.4095,
                  url: "asie/bali/index.html",
                },
                {
                  region: "asie",
                  city: "hongkong",
                  label: "Hong Kong",
                  lon: 114.1694,
                  lat: 22.3193,
                  url: "asie/hongkong/index.html",
                },
                {
                  region: "afrique",
                  city: "nairobi",
                  label: "Nairobi",
                  lon: 36.8219,
                  lat: -1.2921,
                  url: "afrique/nairobi/index.html",
                },
                {
                  region: "afrique",
                  city: "mombasa",
                  label: "Mombasa",
                  lon: 39.6682,
                  lat: -4.0435,
                  url: "afrique/mombasa/index.html",
                },
                {
                  region: "afrique",
                  city: "tiwi",
                  label: "Tiwi Beach",
                  lon: 39.55,
                  lat: -4.27,
                  url: "afrique/tiwi/index.html",
                },
                {
                  region: "afrique",
                  city: "zanzibar",
                  label: "Zanzibar",
                  lon: 39.1925,
                  lat: -6.1659,
                  url: "afrique/zanzibar/index.html",
                },
                {
                  region: "afrique",
                  city: "capetown",
                  label: "Cape Town",
                  lon: 18.4241,
                  lat: -33.9249,
                  url: "afrique/capetown/index.html",
                },
              ];
              function drawSegment(
                px,
                py,
                x,
                y,
                stroke = "#22d3ee",
                curveScale = 0.15,
                curveSign = 1,
                forceCurve = false,
              ) {
                const dx = x - px,
                  dy = y - py;
                const len = Math.hypot(dx, dy);
                const LONG = 100;
                let d, midx, midy;
                if (forceCurve || len > LONG) {
                  const mx = (px + x) / 2,
                    my = (py + y) / 2;
                  const nx = -dy / len,
                    ny = dx / len;
                  const ox = mx + nx * len * curveScale * curveSign,
                    oy = my + ny * len * curveScale * curveSign;
                  d =
                    "M " +
                    px.toFixed(1) +
                    " " +
                    py.toFixed(1) +
                    " Q " +
                    ox.toFixed(1) +
                    " " +
                    oy.toFixed(1) +
                    " " +
                    x.toFixed(1) +
                    " " +
                    y.toFixed(1);
                  midx = (px + 2 * ox + x) / 4;
                  midy = (py + 2 * oy + y) / 4;
                } else {
                  d =
                    "M " +
                    px.toFixed(1) +
                    " " +
                    py.toFixed(1) +
                    " L " +
                    x.toFixed(1) +
                    " " +
                    y.toFixed(1);
                  midx = (px + x) / 2;
                  midy = (py + y) / 2;
                }
                const seg = el("path", {
                  d,
                  fill: "none",
                  stroke,
                  "stroke-width": 2,
                  "stroke-dasharray": "4 4",
                  "stroke-linecap": "round",
                  "vector-effect": "non-scaling-stroke",
                });
                root.appendChild(seg);
                const ux = dx / len,
                  uy = dy / len;
                const theta = (Math.atan2(uy, ux) * 180) / Math.PI;
                const invs = (1 / scale).toFixed(3);
                const ah = el("g", {
                  transform:
                    "translate(" +
                    midx.toFixed(1) +
                    " " +
                    midy.toFixed(1) +
                    ") rotate(" +
                    theta.toFixed(2) +
                    ") scale(" +
                    invs +
                    ")",
                });
                const tri = el("path", {
                  d: "M 0 0 L -10 -5 L -10 5 Z",
                  fill: stroke,
                  stroke: "none",
                });
                ah.appendChild(tri);
                root.appendChild(ah);
                if (!window.__arrowheads) window.__arrowheads = [];
                window.__arrowheads.push({
                  el: ah,
                  x: midx,
                  y: midy,
                  rot: theta,
                  bl: len,
                });
              }
              function drawStraight(px, py, x, y, stroke = "#22d3ee") {
                const d =
                  "M " +
                  px.toFixed(1) +
                  " " +
                  py.toFixed(1) +
                  " L " +
                  x.toFixed(1) +
                  " " +
                  y.toFixed(1);
                const seg = el("path", {
                  d,
                  fill: "none",
                  stroke,
                  "stroke-width": 2,
                  "stroke-dasharray": "4 4",
                  "stroke-linecap": "round",
                  "vector-effect": "non-scaling-stroke",
                });
                root.appendChild(seg);
              }
              if (cities.length > 1) {
                const pts = cities.map((c) => projection([c.lon, c.lat]));
                for (let i = 1; i < pts.length; i++) {
                  const [px, py] = pts[i - 1];
                  const [x, y] = pts[i];
                  const src = cities[i - 1];
                  const dst = cities[i];
                  let cScale = 0.15,
                    cSign = 1;
                  // Existing exceptions
                  if (dst.city === "havana" || dst.city === "havana2") {
                    cScale = 0.3;
                    cSign = -1;
                  }
                  if (
                    dst.city === "capetown" ||
                    dst.city === "varanasi" ||
                    dst.city === "darwin" ||
                    dst.city === "sydney"
                  ) {
                    cScale = Math.max(cScale, 0.22);
                  }
                  // Curved outward for specific pairs requested
                  const pair = src.city + ">" + dst.city;
                  const MUST_CURVE =
                    pair === "mendoza>saopaulo" ||
                    pair === "natal>rio" ||
                    pair === "zanzibar>capetown" ||
                    pair === "katmandou>bali" ||
                    pair === "bali>hongkong";
                  if (MUST_CURVE) {
                    cScale = Math.max(cScale, 0.28);
                    cSign = -1; // curve toward the exterior/opposite side
                  }
                  drawSegment(
                    px,
                    py,
                    x,
                    y,
                    "#22d3ee",
                    cScale,
                    cSign,
                    MUST_CURVE,
                  );
                }
                // Add wrap-around straight link: split the true straight line Havana↔Auckland at the appropriate border (x=0 or x=width)
                function findCity(name) {
                  return cities.find((c) => c.city === name);
                }
                const H = findCity("havana") || findCity("havana2");
                const A = findCity("auckland");
                if (H || A) {
                  const hp = H ? projection([H.lon, H.lat]) : null;
                  const ap = A ? projection([A.lon, A.lat]) : null;
                  if (hp && ap) {
                    const hx = hp[0],
                      hy = hp[1];
                    const ax = ap[0],
                      ay = ap[1];
                    // Choose a horizontal shift k∈{-1,0,1} so that ax' = ax + k*width is closest to hx
                    function bestShift(ax, hx, W) {
                      let bestK = 0,
                        bestD = Math.abs(ax - hx);
                      for (const k of [-1, 1]) {
                        const d = Math.abs(ax + k * W - hx);
                        if (d < bestD) {
                          bestD = d;
                          bestK = k;
                        }
                      }
                      return bestK;
                    }
                    const k = bestShift(ax, hx, width);
                    if (k === 0) {
                      // No wrap needed, draw direct straight link
                      drawStraight(hx, hy, ax, ay, "#22d3ee");
                    } else if (k === -1) {
                      // Shift Auckland left by width, split at x=0
                      const axs = ax - width;
                      const denom = axs - hx;
                      if (Math.abs(denom) > 1e-6) {
                        const t0 = (0 - hx) / denom;
                        const y0 = hy + (ay - hy) * t0; // intersection Y at x=0
                        // Left piece: Havana → west border
                        drawStraight(hx, hy, 0, y0, "#22d3ee");
                        // Right piece: east border → Auckland
                        drawStraight(width, y0, ax, ay, "#22d3ee");
                      }
                    } else {
                      // k === +1
                      // Shift Auckland right by width, split at x=width
                      const axs = ax + width;
                      const denom = axs - hx;
                      if (Math.abs(denom) > 1e-6) {
                        const t1 = (width - hx) / denom;
                        const y1 = hy + (ay - hy) * t1; // intersection Y at x=width
                        // Right piece: Havana → east border
                        drawStraight(hx, hy, width, y1, "#22d3ee");
                        // Left piece: west border → Auckland
                        drawStraight(0, y1, ax, ay, "#22d3ee");
                      }
                    }
                  }
                }
              }
              const paris = [2.3522, 48.8566],
                madrid = [-3.7038, 40.4168],
                capetown = [18.4241, -33.9249];
              const [px1, py1] = projection(paris),
                [mx1, my1] = projection(madrid),
                [cx1, cy1] = projection(capetown);
              drawSegment(px1, py1, mx1, my1, "#22d3ee");
              drawSegment(cx1, cy1, px1, py1, "#22d3ee");
              window.__markers = [];
              const inv0 = 1 / scale;
              cities.forEach((c, i) => {
                const [x, y] = projection([c.lon, c.lat]);
                const mg = el("g", {
                  transform:
                    "translate(" +
                    x.toFixed(1) +
                    " " +
                    y.toFixed(1) +
                    ") scale(" +
                    inv0.toFixed(3) +
                    ")",
                });
                const circ = el("circle", {
                  cx: 0,
                  cy: 0,
                  r: 4,
                  fill: i === 0 ? "#22d3ee" : "#3b82f6",
                  stroke: "#0ea5e9",
                  "stroke-width": 1,
                  "pointer-events": "none",
                });
                const label = el("text", {
                  x: 6,
                  y: -6,
                  fill: "#cbd5e1",
                  "font-size": "12px",
                  "text-anchor": "start",
                  "dominant-baseline": "ideographic",
                  "pointer-events": "none",
                });
                label.textContent = c.label;
                mg.appendChild(circ);
                mg.appendChild(label);
                const hit = el("circle", {
                  cx: 0,
                  cy: 0,
                  r: 8,
                  fill: "transparent",
                });
                hit.style.cursor = "pointer";
                hit.addEventListener("click", () => {
                  window.location.href = c.url;
                });
                mg.appendChild(hit);
                root.appendChild(mg);
                window.__markers.push({ el: mg, x: x, y: y });
              });
              // Add Paris marker explicitly
              {
                const p = projection([2.3522, 48.8566]);
                const px = p[0],
                  py = p[1];
                const pmg = el("g", {
                  transform:
                    "translate(" +
                    px.toFixed(1) +
                    " " +
                    py.toFixed(1) +
                    ") scale(" +
                    inv0.toFixed(3) +
                    ")",
                });
                const pc = el("circle", {
                  cx: 0,
                  cy: 0,
                  r: 4,
                  fill: "#22d3ee",
                  stroke: "#0ea5e9",
                  "stroke-width": 1,
                  "pointer-events": "none",
                });
                const pl = el("text", {
                  x: 6,
                  y: -6,
                  fill: "#cbd5e1",
                  "font-size": "12px",
                  "text-anchor": "start",
                  "dominant-baseline": "ideographic",
                  "pointer-events": "none",
                });
                pl.textContent = "Paris";
                pmg.appendChild(pc);
                pmg.appendChild(pl);
                root.appendChild(pmg);
                if (!window.__markers) window.__markers = [];
                window.__markers.push({ el: pmg, x: px, y: py });
              }

              // Ensure initial state of arrowheads matches current scale
              applyTransform();
            } catch (err) {
              const msg = el("text", { x: 20, y: 40, fill: "#ef4444" });
              msg.textContent =
                "Carte indisponible hors-ligne (assets manquants).";
              svg.appendChild(msg);
            }
          })();
        </script>
      </main>
    </div>

    <!-- Theme scripts -->
    <script src="assets/lightbox.js"></script>
    <script src="assets/theme.js"></script>
  </body>
</html>
